MAIN                                                                                                          PAGE 1

                       1    $MOD51                                          ; This includes 8051 definitions for the Met
                                                                               alink assembler
                       2    
  0080                 3    RS                      EQU     P0.0    ; Register select: selects command register when low
                                                                               , data register when high
  0081                 4    RW                      EQU             P0.1    ; Read/write: low to write to the register, 
                                                                               high to read from the register
  0082                 5    EN                      EQU     P0.2    ; Enable: sends data to data pins when a high to low
                                                                                pulse is given
  00A7                 6    D7                      EQU             P2.7    ; D7: busy flag of LCD, when high means LCD 
                                                                               busy and no info should be issued
  00A0                 7    DATA_PORT       EQU     P2              ; Define input port
                       8    
                       9    
0000                  10    ORG     0000H
0000                  11    MAIN:   
                      12                    ; Write commands to LCD
0000 7438             13                    MOV             A,      #38H    ; 8-bit, 2 line, 5x7 dots
0002 1142             14                    ACALL   CMND_WRT
0004 740E             15                    MOV             A,      #0EH    ; Display ON cursor, ON
0006 1142             16                    ACALL   CMND_WRT
0008 7406             17                    MOV     A,      #06H    ; Auto increment mode, i.e., when we send char, curs
                                                                               or position moves right
000A 1142             18                    ACALL   CMND_WRT
000C 7401             19                    MOV     A,      #01H    ; Clear display
000E 1142             20                    ACALL   CMND_WRT
0010 7480             21                    MOV     A,      #80H    ; Bring cursor to line 1, position 0
0012 1142             22                    ACALL   CMND_WRT
                      23                    
                      24                    ; Display 'HELLO' on line 1
0014 7448             25                    MOV     A,      #'H'
0016 114F             26                    ACALL   DATA_WRT
0018 7445             27                    MOV     A,      #'E'
001A 114F             28                    ACALL   DATA_WRT
001C 744C             29                    MOV     A,      #'L'
001E 114F             30                    ACALL   DATA_WRT
0020 744C             31                    MOV     A,      #'L'
0022 114F             32                    ACALL   DATA_WRT
0024 744F             33                    MOV     A,      #'O'
0026 114F             34                    ACALL   DATA_WRT
                      35    
0028 74C0             36                    MOV     A,      #0C0H   ; Bring cursor to line 2, position 0
002A 1142             37                    ACALL   CMND_WRT
                      38    
                      39                    ; Display 'WORLD' on line 2
002C 7457             40                    MOV     A,      #'W'
002E 114F             41                    ACALL   DATA_WRT
0030 744F             42                    MOV     A,      #'O'
0032 114F             43                    ACALL   DATA_WRT
0034 7452             44                    MOV     A,      #'R'
0036 114F             45                    ACALL   DATA_WRT
0038 744C             46                    MOV     A,      #'L'
003A 114F             47                    ACALL   DATA_WRT
003C 7444             48                    MOV     A,      #'D'
003E 114F             49                    ACALL   DATA_WRT
                      50    
0040 80BE             51                    SJMP MAIN
                      52    
MAIN                                                                                                          PAGE 2

                      53    ; CMND_WRT subroutine: send command to LCD              
0042                  54    CMND_WRT:       ;ACALL  READY
0042 F5A0             55                            MOV     DATA_PORT,      A
0044 C280             56                            CLR     RS                              ; RS = 0 for command
0046 C281             57                            CLR     RW                              ; RW = 0 for write
0048 D282             58                            SETB    EN                              ; EN = 1 for high pulse
004A 115C             59                            ACALL   DELAY                   ; Call DELAY subroutine
004C C282             60                            CLR     EN                              ; EN = 0 for low pulse
004E 22               61                            RET
                      62    
                      63    ; DATA_WRT subroutine: send data to LCD and display
004F F5A0             64    DATA_WRT:       MOV     DATA_PORT,      A
0051 D280             65                            SETB    RS                              ; RS = 1 for data
0053 C281             66                            CLR     RW                              ; RW = 0 for write
0055 D282             67                            SETB    EN                              ; EN = 1 for high pulse
0057 115C             68                            ACALL   DELAY                   ; Call DELAY subroutine
0059 C282             69                            CLR     EN                              ; EN = 0 for low pulse
005B 22               70                            RET
                      71                    
005C 7BFF             72    DELAY:          MOV     R3,     #255
005E 7C04             73    L2:             MOV     R4,             #4
0060 DCFE             74    L1:             DJNZ    R4,     L1
0062 DBFA             75                            DJNZ    R3,     L2
0064 22               76                            RET
                      77                    
                      78    ;READY:
                      79    ;       SETB    D7                                              ; Initiate LCD as busy
                      80    ;       CLR     RS                                              ; RS = 0 for command
                      81    ;       SETB    RW                                              ; RW = 1 for read
                      82            
                      83    ;BACK:
                      84    ;       CLR     EN                                              ; EN = 0, start LCD command
                                                                               
                      85    ;       ACALL   DELAY                                   ; Call DELAY subroutine
                      86    ;       SETB    EN                                              ; EN = 1, clock out command 
                                                                               to LCD
                      87    ;       MOV     DATA_PORT,      #0FFh           ; Set pins to 0FF (1111 1111)
                      88    ;       MOV     A,              DATA_PORT               ; Read the return value
                      89    ;       JB              D7,             BACK                    ; If bit 7 high, LCD still b
                                                                               usy
                      90    ;       RET
                      91    
                      92    END

VERSION 1.2k ASSEMBLY COMPLETE, 0 ERRORS FOUND
MAIN                                                                                                          PAGE 3

CMND_WRT . . . . . . . . . . . .  C ADDR  0042H  
D7 . . . . . . . . . . . . . . .    NUMB  00A7H  NOT USED  
DATA_PORT. . . . . . . . . . . .    NUMB  00A0H  
DATA_WRT . . . . . . . . . . . .  C ADDR  004FH  
DELAY. . . . . . . . . . . . . .  C ADDR  005CH  
EN . . . . . . . . . . . . . . .    NUMB  0082H  
L1 . . . . . . . . . . . . . . .  C ADDR  0060H  
L2 . . . . . . . . . . . . . . .  C ADDR  005EH  
MAIN . . . . . . . . . . . . . .  C ADDR  0000H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
RS . . . . . . . . . . . . . . .    NUMB  0080H  
RW . . . . . . . . . . . . . . .    NUMB  0081H  
